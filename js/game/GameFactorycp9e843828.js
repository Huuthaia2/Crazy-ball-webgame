var touch;!function(e){var t;!function(e){e[e.POOL=0]="POOL",e[e.LAYER=1]="LAYER"}(t=e.RECYCLE_METHOD||(e.RECYCLE_METHOD={}));var a=function(){function a(){this._speedWind=null,this._sprintEffect=null,this._sprintSkin=null,this._deadPointMesh=null,this._shadowMaterial=null,this._box=null,this._boxTexture=null,this._stoneParticles=null,this._buildMaterial=null,this._building=null,this._accelerateBlock=null,this._plane=null,this._recycleLayer=null,this._ballMaterial=null,this.ballSkinTexture=null,this._aiNameTextures=null,this._diamondMesh=null,this._diamondTexture=null,this._diamondMaterial=null,this._diamondNode=null,this._powerupMesh=null,this._powerupTexture=null,this._powerupNode=null,this._loadingAssets=[],this._loadLength=0,this._recycleZ=0,this._ready=!1}return Object.defineProperty(a,"instance",{get:function(){return a._inst||(a._inst=new a).init(),a._inst},enumerable:!1,configurable:!0}),a.prototype.init=function(){},a.prototype._addPreloadSprite3D=function(e,t){var a=Laya.Sprite3D.load(e);return a.active=!1,this._loadingAssets.indexOf(e)<0&&(this._loadingAssets.push(e),a.on(Laya.Event.HIERARCHY_LOADED,this,this.onAssetLoaded)),t&&a.once(Laya.Event.HIERARCHY_LOADED,this,t,[a]),a},a.prototype._addPreloadAsset=function(e,t,a){var r=e.load(t);return this._loadingAssets.indexOf(t)<0&&(this._loadingAssets.push(t),r.on(Laya.Event.LOADED,this,this.onAssetLoaded)),a&&r.once(Laya.Event.LOADED,this,a,[r]),r},a.prototype.preloadResource=function(t){var a=this,r=new Laya.Sprite3D;r.name="RECYCLE",t.addChild(r),this._recycleLayer=r,this._speedWind=this._addPreloadSprite3D("res/scene/layaScene.lh"),this._addPreloadSprite3D("res/sprint_fx/sprint_fx_12_001.lh",function(e){a._sprintEffect=e.getChildByName("sprint_fx_12_001")}),this._addPreloadSprite3D("res/Stone/Stone.lh",function(e){a._stoneParticles=e.getChildByName("Stone")}),this.pointMesh=this._addPreloadAsset(Laya.Mesh,"res/scene/deadpoint.lm"),this._addPreloadAsset(Laya.Texture2D,"res/skin/whiteCube.png",function(t){a._shadowMaterial=new e.CustomMaterial,a._shadowMaterial.setDiffuseTexture(t),a._shadowMaterial.setHasLight(!1),a._shadowMaterial.setFogDensity(.04),a._shadowMaterial.setFogColor(e.SkinManager.curFogColor),a._shadowMaterial.setTransparent(),a._shadowMaterial.setColor(new Laya.Vector4(0,0,0,.3))}),this._addPreloadAsset(Laya.Texture2D,"res/skin/cube.png",function(t){a._boxTexture=t;var r=new e.CustomMaterial;r.setDiffuseTexture(t);var n=new Laya.BoxMesh(1,1,1);a._box=new Laya.MeshSprite3D(n),a._box.meshRender.sharedMaterial=r}),this._addPreloadAsset(Laya.Texture2D,"res/skin/whiteCube.png",function(t){a._buildMaterial=new e.CustomMaterial,a._buildMaterial.setDiffuseTexture(t),a._buildMaterial.setHasLambert(!0),a._buildMaterial.setFogDensity(.04)}),this.accMesh=this._addPreloadAsset(Laya.Mesh,"res/scene/boost-acc.lm"),this.planeMesh=this._addPreloadAsset(Laya.Mesh,"res/scene/plane.lm"),this._ballMaterial=new e.CustomMaterial,this._ballMaterial.setTransparent(),this._ballMaterial.setFogDensity(.04),this.ballSkinTexture=new Array;for(n=0;n<e.GameConfig.SKIN_VIDEO.length;n++)this.ballSkinTexture.push(this._addPreloadAsset(Laya.Texture2D,"res/skin/skin"+n+".png"));this._aiNameTextures=new Array;for(var n=0;n<e.SkinManager.AI_NAME_NUM;n++)this._aiNameTextures.push(this._addPreloadAsset(Laya.Texture2D,"res/ai_names/"+n+".png"));e.GameData.instance.config.diamondGroup.enabled&&(this._diamondMesh=this._addPreloadAsset(Laya.Mesh,"res/diamond/Assets/diamond-diamond.lm"),this._diamondTexture=this._addPreloadAsset(Laya.Texture2D,"res/diamond/Assets/diamond.png")),e.GameData.instance.config.powerupGroup.enabled&&(this._powerupMesh=this._addPreloadAsset(Laya.Mesh,"res/sprint_fx/Assets/model/flash_003-flash_003.lm"),this._powerupTexture=this._addPreloadAsset(Laya.Texture2D,"res/sprint_fx/Assets/texture/flash_003.png"))},a.prototype.onAssetLoaded=function(){if(this._loadingAssets.shift(),GameBaseData.isDebug&&console.log("this._loadingAssets.length = "+this._loadingAssets.length),!(this._loadingAssets.length>0)){var t=new e.CustomMaterial;t.setTransparent(),t.setDiffuseTexture(Laya.Texture2D.load("res/skin/whiteCube.png")),t.setHasLight(!1),this._deadPointMesh=new Laya.MeshSprite3D(this.pointMesh),this._deadPointMesh.transform.rotate(new Laya.Vector3(90,-120,0),!0,!1),this._deadPointMesh.meshRender.sharedMaterial=t;var r=new e.CustomMaterial;r.setDiffuseTexture(Laya.Texture2D.load("res/skin/whiteCube.png")),r.setColor(new Laya.Vector4(251/255,253/255,73/255,1)),r.setHasLight(!1),this._accelerateBlock=new Laya.MeshSprite3D(this.accMesh),this._accelerateBlock.transform.rotate(new Laya.Vector3(90,-120,0),!0,!1),this._accelerateBlock.meshRender.sharedMaterial=r,this._accelerateBlock.name=a.POOL.ACCELERATE_BLOCK;var n=new e.CustomMaterial;if(n.setDiffuseTexture(Laya.Texture2D.load(e.SkinManager.planeTexture)),n.setHasLight(!1),this._plane=new Laya.MeshSprite3D(this.planeMesh),this._plane.transform.localScale=new Laya.Vector3(10,1,10),this._plane.meshRender.sharedMaterial=n,e.GameData.instance.config.diamondGroup.enabled){var i=new e.CustomMaterial;i.setDiffuseTexture(this._diamondTexture),i.setHasLight(!1),this._diamondNode=new Laya.MeshSprite3D(this._diamondMesh),this._diamondNode.meshRender.sharedMaterial=i,this._diamondNode.transform.rotate(new Laya.Vector3(-90,0,0),!0,!1),this._diamondNode.name=a.POOL.DIAMOND}if(e.GameData.instance.config.powerupGroup.enabled){var s=new e.CustomMaterial;s.setDiffuseTexture(this._powerupTexture),s.setHasLight(!1),this._powerupNode=new Laya.MeshSprite3D(this._powerupMesh),this._powerupNode.meshRender.sharedMaterial=s,this._powerupNode.transform.rotate(new Laya.Vector3(-90,0,0),!0,!1),this._powerupNode.name=a.POOL.POWER_UP}this.preCreate()}},Object.defineProperty(a.prototype,"isReady",{get:function(){return this._ready},enumerable:!1,configurable:!0}),a.prototype.preCreate=function(){for(var r=this,n=0;n<e.GameDefine.MAX_BOX_NUM;n++)this.recycleObstacle(this.createObstacleBox(!0));for(n=0;n<e.GameDefine.MAX_ACCELERATE_BLOCL_NUM;n++)this.recycleObject(this.createAccelerateBlock(!0),a.POOL.ACCELERATE_BLOCK,t.LAYER);for(n=0;n<e.GameDefine.MAX_BUILD_NUM;n++)this.recycleObject(this.createBuilding(!0),a.POOL.BUIDLING,t.LAYER);for(n=0;n<e.GameDefine.MAX_DEA_POINT_NUM;n++)this.recycleObject(this.createDeadPoint(!0),a.POOL.DEAD_POINT,t.LAYER);if(e.GameData.instance.config.diamondGroup.enabled)for(n=0;n<20;n++)this.recycleObject(this.createDiamond(!0),a.POOL.DIAMOND,t.LAYER);if(e.GameData.instance.config.powerupGroup.enabled)for(n=0;n<20;n++)this.recycleObject(this.createPowerup(!0),a.POOL.POWER_UP,t.LAYER);for(n=0;n<20;n++){var i=this.createStoneParticles(!0);this.recycleStoneParticles(i)}Laya.timer.once(100,this,function(){r._recycleZ=500;for(var t=0;t<r._recycleLayer.numChildren;t++){r._recycleLayer.getChildAt(t).transform.position=new Laya.Vector3(0,0,r._recycleZ)}r._ready=!0,e.GameModule.instance.event(e.GameEvent.FACTORY_READY)})},a.prototype.getSkinTexture=function(e){return this.ballSkinTexture[e]},a.prototype.getSkinIconUrl=function(e){},a.prototype.getAllSkins=function(){return this.ballSkinTexture},a.prototype.getNameTexture=function(e){return this._aiNameTextures[e]},a.prototype.createSprintEffect=function(e){var t=Laya.Sprite3D.instantiate(this._sprintEffect);return t.transform.rotate(new Laya.Vector3(0,180,0),!1,!1),t},a.prototype.createObstacleBox=function(t,r,n){var i=t?null:Laya.Pool.getItem(a.POOL.OBSTACLE_BOX);if(null==i){(i=Laya.Sprite3D.instantiate(this._box,null,!1)).name=a.POOL.OBSTACLE_BOX;i.addComponent(Laya.BoxCollider).setFromBoundBox(i.meshFilter.sharedMesh.boundingBox),t||console.warn("Pool is empty: ",a.POOL.OBSTACLE_BOX)}return i.meshRender.material.setColor(new Laya.Vector4(1,1,1,.1)),i.meshRender.material.setFogColor(e.SkinManager.curFogColor),r&&(i.transform.position=new Laya.Vector3(r.x,r.y,r.z)),n&&n.addChild(i),i.active=!0,i},a.prototype.createStoneParticles=function(e,t,r){var n=e?null:this.getFromRecycleLayer(a.POOL.STONE_PARTICLES);if(null==n)(n=Laya.Sprite3D.instantiate(this._stoneParticles)).name=a.POOL.STONE_PARTICLES,e||console.warn("Pool is empty: ",a.POOL.STONE_PARTICLES);else for(var i=0;i<this._stoneParticles.numChildren;i++){n.getChildAt(i).transform.localPosition=this._stoneParticles.getChildAt(i).transform.localPosition.clone()}return t&&(n.transform.position=new Laya.Vector3(t.x,t.y,t.z)),r&&r.addChild(n),n.active=!0,n},a.prototype.createDiamond=function(t,r,n){var i=t?null:this.getFromRecycleLayer(a.POOL.DIAMOND);if(null==i){(i=Laya.Sprite3D.instantiate(this._diamondNode,null,!1)).name=a.POOL.DIAMOND;var s=i.addComponent(Laya.BoxCollider);s.center=new Laya.Vector3(0,.5,0),s.size=new Laya.Vector3(1,1,1);i.transform.localScale=new Laya.Vector3(.5,.5,.5),t||console.warn("Pool is empty: ",a.POOL.DIAMOND)}return i.meshRender.material.setColor(new Laya.Vector4(1,1,1,1)),i.meshRender.material.setFogColor(e.SkinManager.curFogColor),r&&(i.transform.position=new Laya.Vector3(r.x,r.y,r.z)),n&&n.addChild(i),i.active=!0,i},a.prototype.createPowerup=function(t,r,n){var i=t?null:this.getFromRecycleLayer(a.POOL.POWER_UP);if(null==i){(i=Laya.Sprite3D.instantiate(this._powerupNode,null,!1)).name=a.POOL.POWER_UP;var s=i.addComponent(Laya.BoxCollider);s.center=new Laya.Vector3(0,.5,0),s.size=new Laya.Vector3(1,1,1);i.transform.localScale=new Laya.Vector3(.75,.75,.75),t||console.warn("Pool is empty: ",a.POOL.POWER_UP)}return i.meshRender.material.setColor(new Laya.Vector4(1,1,1,1)),i.meshRender.material.setFogColor(e.SkinManager.curFogColor),r&&(i.transform.position=new Laya.Vector3(r.x,r.y,r.z)),n&&n.addChild(i),i.active=!0,i},a.prototype.createBall=function(t,a,r){var n=new Laya.SphereMesh(.25,16,16),i=new Laya.MeshSprite3D(n);i.addComponent(e.BallScript),r&&(i.transform.position=new Laya.Vector3(r.x,r.y,r.z)),i.meshRender.material=this._ballMaterial;var s=0;s=t?e.GameData.instance.showSkinIndex:e.MathUtil.randomInt(0,e.GameConfig.SKIN_VIDEO.length-1);var o=i.getComponentByType(e.BallScript);o.skinIndex=s,i.meshRender.material.setDiffuseTexture(this.ballSkinTexture[s]),i.meshRender.material.setFogColor(e.SkinManager.fogColors[s]),i.meshRender.material.setColor(new Laya.Vector4(1,1,1,1));var l=i.addComponent(Laya.SphereCollider);i.addComponent(Laya.Rigidbody),l.center=i.meshFilter.sharedMesh.boundingSphere.center.clone(),l.radius=i.meshFilter.sharedMesh.boundingSphere.radius;var c=new Laya.CylinderMesh(.2,.01,64),h=new Laya.MeshSprite3D(c);h.meshRender.material=this._shadowMaterial,h.transform.position=new Laya.Vector3(i.transform.position.x,.004,i.transform.position.z),a.shadowParent&&a.shadowParent.addChild(h);var d=new Laya.Glitter,u=d.glitterRender.sharedMaterial;u.diffuseTexture=Laya.Texture2D.load("res/tail/"+o.skinIndex+".png"),u.albedo=new Laya.Vector4(1,1,1,1),a.trailParent&&a.trailParent.addChild(d);var p=d.templet;if(p.lifeTime=.12,p.minSegmentDistance=.1,p.minInterpDistance=.6,p.maxSlerpCount=128,p.maxSegments=600,a.sprintParent){var y=this.createSprintEffect();a.sprintParent.addChild(y),o.setSprint(y),o.showSprint(!1)}return o.setSkin(this.ballSkinTexture[s]),o.setTrail(d),o.setTrailTexture(Laya.Texture2D.load("res/tail/"+o.skinIndex+".png")),o.setShadow(h),i},a.prototype.createAccelerateBlock=function(t,r){var n=t?null:this.getFromRecycleLayer(a.POOL.ACCELERATE_BLOCK);if(null==n){var i=(n=Laya.Sprite3D.instantiate(this._accelerateBlock,null,!1)).addComponent(Laya.BoxCollider);i.center=new Laya.Vector3(0,0,0),i.size=new Laya.Vector3(.9526,.5,.2),t||console.warn("Pool is empty: ",a.POOL.ACCELERATE_BLOCK)}return n.meshRender.material.setFogColor(e.SkinManager.curFogColor),r&&(n.transform.position=new Laya.Vector3(r.x,r.y,r.z)),n.name=a.POOL.ACCELERATE_BLOCK,n},a.prototype.createPlane=function(t,r){var n=t?null:this.getFromRecycleLayer(a.POOL.PLANE);null==n&&(n=Laya.Sprite3D.instantiate(this._plane,null,!1));var i=n.meshRender.material;return i.setFogColor(e.SkinManager.curFogColor),i.setDiffuseTexture(Laya.Texture2D.load(e.SkinManager.planeTexture)),r&&(n.transform.position=new Laya.Vector3(r.x,r.y,r.z)),n},a.prototype.createDeadPoint=function(t,r,n){var i=t?null:this.getFromRecycleLayer(a.POOL.DEAD_POINT);return null==i&&(i=Laya.Sprite3D.instantiate(this._deadPointMesh,null,!1)),i.meshRender.material.setFogColor(e.SkinManager.curFogColor),n&&i.meshRender.material.setColor(n),r&&(i.transform.position=new Laya.Vector3(r.x,.005,r.z)),i.transform.scale=new Laya.Vector3(.3,.3,1),t||i.timer.frameLoop(1,i,function(){var e=Laya.timer.delta;i.transform.scale.x<6?i.transform.scale=new Laya.Vector3(i.transform.scale.x+.08*e,i.transform.scale.x+.08*e,1):i.transform.scale.x>6&&(i.transform.scale=new Laya.Vector3(6,6,1))}),i.isExceed=void 0,i},a.prototype.createBuilding=function(t,r){var n=t?null:this.getFromRecycleLayer(a.POOL.BUIDLING);if(null==n){if(null==this._building){var i=new Laya.BoxMesh(5,5,30);(n=new Laya.MeshSprite3D(i)).meshRender.sharedMaterial=this._buildMaterial,this._building=n}n=Laya.MeshSprite3D.instantiate(this._building)}return n.meshRender.material.setFogColor(e.SkinManager.curFogColor),r&&(n.transform.position=new Laya.Vector3(r.x,r.y,r.z)),n},a.prototype.createAIName=function(t){var a=new Laya.BoxMesh(2,.001,.2),r=new Laya.MeshSprite3D(a);r.transform.position=new Laya.Vector3(0,0,1e3);var n=new e.CustomMaterial;return t&&n.setDiffuseTexture(t),n.setColor(new Laya.Vector4(1,1,1,1)),n.setHasLight(!1),n.setHasFog(!1),n.setHasAlphaTest(!0),n.setAlphaTestValue(.5),n.setTransparent(),r.meshRender.material=n,r},a.prototype.createSpeedWind=function(){return Laya.MeshSprite3D.instantiate(this._speedWind)},a.prototype.getSprintSkin=function(){return this._sprintSkin},a.prototype.recycleChildObjects=function(e,t,a,r,n,i,s){for(var o=t?t.position.z:0,l=e.numChildren-1;l>=0;l--){var c=e.getChildAt(l);(!t||c.transform.position.z-o>=a)&&(i&&this.recycleChildObjects(c,null,0,r,n,i),s&&!s(c)||this.recycleObject(c,r,n))}},a.prototype.recycleObject=function(e,a,r){e.timer.clearAll(e),e.removeSelf(),a&&""!=a||(a=e.name),""!=a?r==t.LAYER?this.putBackRecycleLayer(e,a):Laya.Pool.recover(a,e):console.warn("Missing Pool Name: ",e)},a.prototype.recycleObstacle=function(e){this.recycleObject(e,a.POOL.OBSTACLE_BOX,t.POOL)},a.prototype.recycleDiamond=function(e){this.recycleObject(e,a.POOL.DIAMOND,t.LAYER)},a.prototype.recyclePowerup=function(e){this.recycleObject(e,a.POOL.POWER_UP,t.LAYER)},a.prototype.recycleStoneParticles=function(e){this.putBackRecycleLayer(e,a.POOL.STONE_PARTICLES)},a.prototype.putBackRecycleLayer=function(e,t){t&&(e.name=t),e.timer.clearAll(e),this._recycleLayer.addChild(e),e.transform.position=new Laya.Vector3(0,0,this._recycleZ)},a.prototype.getFromRecycleLayer=function(e){for(var t=null,a=0;a<this._recycleLayer.numChildren;a++){var r=this._recycleLayer.getChildAt(a);if(r.name==e){(t=r).active=!0;break}}return t},a.POOL={OBSTACLE_BOX:"OBSTACLE_BOX",BUIDLING:"BUIDLING",PLANE:"PLANE",DEAD_POINT:"DEAD_POINT",DIAMOND:"DIAMOND",POWER_UP:"POWER_UP",ACCELERATE_BLOCK:"ACCELERATE_BLOCK",STONE_PARTICLES:"STONE"},a}();e.GameFactory=a}(touch||(touch={}));