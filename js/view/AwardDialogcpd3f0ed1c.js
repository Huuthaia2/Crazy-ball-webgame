var touch,__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(e){var t;!function(e){e.success="success",e.fail="failed",e.cancel="cancel"}(t||(t={}));var n=function(n){function i(e){var t=n.call(this)||this;return t._main=null,t._onlineRemainingTime=0,t.onlineGiftIndex=0,t._main=e,t.btnClose.clickHandler=Laya.Handler.create(t,t.onClickClose,null,!1),t.btnAward00.clickHandler=Laya.Handler.create(t,t.onClickAward00,null,!1),t.btnAward11.clickHandler=Laya.Handler.create(t,t.onClickAward11,null,!1),t.btnAward22.clickHandler=Laya.Handler.create(t,t.onClickAward22,null,!1),t.btnBuy.clickHandler=Laya.Handler.create(t,t.onBuyDiaond,null,!1),t.updateOnlineReward(),t.payItem.visible=GameBaseData.isSupportPay,t.bg.height=GameBaseData.isSupportPay?790:600,t}return __extends(i,n),i.prototype.updateOnlineReward=function(){this.btnAward0.visible=!0,this.btnAward00.visible=!1,this.tfDiamond.text=e.GameData.instance.diamond.toString(),this.txtAward1.text="Tomorrow";for(var t=e.GameData.instance.onlineIndex,n=0;n<e.GameConfig.ONLINE_GIFT.length;n++){var a=e.GameConfig.ONLINE_GIFT[n];if(!(a.index<=t)){this.onlineGiftIndex=a.index,a.time<=e.GameData.instance.onlineTime?(this.btnAward0.visible=!1,this.btnAward00.visible=!0):(this._onlineRemainingTime=a.time-e.GameData.instance.onlineTime,this.txtAward0.text=e.TimeUtil.getHourMinuteSecond(1e3*this._onlineRemainingTime),Laya.timer.clear(this,this.timeLoop),Laya.timer.loop(1e3,this,this.timeLoop));break}}e.GameData.instance.dailyVaild?(this.btnAward1.visible=!1,this.btnAward11.visible=!0):(this.btnAward1.visible=!0,this.btnAward11.visible=!1),i.friendNums>4?(this.btnAward2.visible=!0,this.btnAward22.visible=!1):(this.btnAward2.visible=!1,this.btnAward22.visible=!0)},i.prototype.destroy=function(){null!=this.btnClose.clickHandler&&(this.btnClose.clickHandler.recover(),this.btnClose.clickHandler=null),null!=this.btnAward00.clickHandler&&(this.btnAward00.clickHandler.recover(),this.btnAward00.clickHandler=null),null!=this.btnAward11.clickHandler&&(this.btnAward11.clickHandler.recover(),this.btnAward11.clickHandler=null),null!=this.btnAward22.clickHandler&&(this.btnAward22.clickHandler.recover(),this.btnAward22.clickHandler=null),null!=this.btnBuy.clickHandler&&(this.btnBuy.clickHandler.recover(),this.btnBuy.clickHandler=null),n.prototype.destroy.call(this)},i.prototype.timeLoop=function(){this._onlineRemainingTime--,this.txtAward0.text=e.TimeUtil.getHourMinuteSecond(1e3*this._onlineRemainingTime),this._onlineRemainingTime<=0&&(Laya.timer.clear(this,this.timeLoop),this.updateOnlineReward())},i.prototype.onClickAward00=function(){SdkHelper.EventLogger.logDailyGiftAdButtonClick(),this.playNativeAward()},i.prototype.playNativeAward=function(){GameBaseData.isNative?this.playIronSourceVideo():this.playH5Video()},i.prototype.playIronSourceVideo=function(){var t=this;SdkHelper.IronSourceHelper.isVideoReady()?SdkHelper.IronSourceHelper.showVideoAdsAsync(function(n){n?(SdkHelper.EventLogger.logAdShowEvent("DailyAward",e.GameData.instance.isNewUser),e.GameData.instance.setAddDiamond(100),e.GameData.instance.onlineIndex=t.onlineGiftIndex,e.Notice.show("Successful get 100 diamonds."),SdkHelper.EventLogger.logAwardReceiveAd(),SdkHelper.EventLogger.logAwardReceiveAdWithTimes()):e.Notice.show("Ads needs to be completed to get rewards"),t.updateOnlineReward()}):(console.info("Reward Ads Not Ready"),e.Notice.show("Ads Not Ready, Try Again Later"))},i.prototype.playH5Video=function(){var t=this;SdkHelper.MiniGameSDKHelper.isRewardVideoReady()?SdkHelper.MiniGameSDKHelper.showRewardedVideo(function(n){n?(SdkHelper.EventLogger.logAdShowEvent("DailyAward",e.GameData.instance.isNewUser),e.GameData.instance.setAddDiamond(100),e.GameData.instance.onlineIndex=t.onlineGiftIndex,SdkHelper.EventLogger.logAwardReceiveAd(),SdkHelper.EventLogger.logAwardReceiveAdWithTimes(),e.Notice.show("Successful get 100 diamonds.")):e.Notice.show("Ads needs to be completed to get rewards"),t.updateOnlineReward()}):(console.info("Reward Ads Not Ready"),e.Notice.show("Ads Not Ready, Try Again Later"))},i.prototype.onClickAward11=function(){e.GameData.instance.setAddDiamond(200),e.Notice.show("Successful get 200 diamonds."),e.GameData.instance.dailyVaild=!1,this.updateOnlineReward(),SdkHelper.EventLogger.logAwardReceive(),SdkHelper.EventLogger.logAwardReceiveWithTimes()},i.prototype.onClickAward22=function(){i.isFromAward=!0,this.close(),this._main.event(e.GameEvent.OPEN_RANK)},i.prototype.onClickClose=function(){this.close(),SdkHelper.MiniGameSDKHelper.hideBanner(),SdkHelper.SdkUtils.setAdflyState(1)},i.prototype.onBuyDiaond=function(){var n=this;if(SdkHelper.SdkUtils.isH5Platform){var i=window.minigame,a={};a.productID="minigameball001",i.payments.purchaseAsync(a).then(function(t){i.payments.consumePurchaseAsync(t.purchaseToken).then(function(){e.GameData.instance.setAddDiamond(1e3),n.tfDiamond.text=e.GameData.instance.diamond.toString(),e.Notice.show("Successful buy 1000 diamonds.")}).catch(function(e){console.error("====> consumePurchaseAsync error: "+e)})}).catch(function(t){console.error("====> purchaseAsync error: "+t),e.Notice.show("fail to pay diamond")})}else SdkHelper.PayHelper.pay(function(i){switch(i){case t.success:e.GameData.instance.setAddDiamond(1e3),n.tfDiamond.text=e.GameData.instance.diamond.toString(),e.Notice.show("Successful buy 1000 diamonds.");break;case t.fail:case t.cancel:e.Notice.show("fail to pay diamond: "+i)}})},i.isFromAward=!1,i.friendNums=0,i}(ui.AwardDialogUI);e.AwardDialog=n}(touch||(touch={}));