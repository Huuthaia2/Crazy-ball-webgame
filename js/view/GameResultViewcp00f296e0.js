var touch,__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}();!function(e){var t=function(t){function a(){var a=t.call(this)||this;return a._nextSkinId=0,a.btnHome.clickHandler=Laya.Handler.create(a,a.onGoHome,null,!1),a.btnSkin.clickHandler=Laya.Handler.create(a,a.onSkinShop,null,!1),a.btnRestart.clickHandler=Laya.Handler.create(a,a.onRestart,null,!1),a.btnAwards.clickHandler=Laya.Handler.create(a,a.onAwards,null,!1),e.GameModule.instance.on(e.GameEvent.CHANGE_SKIN,a,a._onSkinChange),a._nextSkinId=e.GameData.instance.skinIndex,Laya.timer.callLater(a,a.showSkin),a.imgNewScore.visible=!1,SdkHelper.MiniGameSDKHelper.onLevelFinished(!0,0,GameBaseData.score),a}return __extends(a,t),a.prototype.destroy=function(){e.GameModule.instance.off(e.GameEvent.CHANGE_SKIN,this,this._onSkinChange),t.prototype.destroy.call(this)},a.prototype._onSkinChange=function(){this.imgBall.skin="index/skin"+e.GameData.instance.skinIndex+".png",this.udpateSkin(e.GameData.instance.skinIndex),this.boxSkinTask.visible=!1},a.prototype.onSkinShop=function(){SdkHelper.EventLogger.logSkinPageButtonClick(a.PAGE),e.GameModule.instance.event(e.GameEvent.OPEN_SKIN)},a.prototype.onGoHome=function(){this.visible=!1,e.GameModule.instance.event(e.GameEvent.BACK)},a.prototype.onRestart=function(){GameBaseData.isNative?this.onRestartNative():(this.visible=!1,e.GameModule.instance.event(e.GameEvent.START_AGAIN),SdkHelper.MiniGameSDKHelper.onLevelStart(0))},a.prototype.onRestartNative=function(){this.visible=!1,e.GameModule.instance.event(e.GameEvent.START_AGAIN)},a.prototype.onRestartH5=function(){var t=this;SdkHelper.MiniGameSDKHelper.isInterstitialReady()?SdkHelper.MiniGameSDKHelper.showInterstitial(function(a){t.visible=!1,e.GameModule.instance.event(e.GameEvent.START_AGAIN)}):(this.visible=!1,e.GameModule.instance.event(e.GameEvent.START_AGAIN))},a.prototype.updateDisplay=function(){var t=this;this._parent&&this.timer.frameOnce(1,this,function(){t.imgBg.width=t._parent.width,t.imgBg.height=t._parent.height,t.imgBg.x=0,t.imgBg.y=0});var a=!1,n=GameBaseData.score,i=GameBaseData.isSinglePlayerMode?e.TaskManager.instance.getBestDistance():e.TaskManager.instance.getBestSurpass();if(i<n&&(i=n,a=!0),this.txtScore.text=n.toString(),this.txtBestScore.text=i.toString(),this.imgNewScore.visible=a,a){var s=n.toString().length/2;this.imgNewScore.centerX=40+30*s}var r=[];GameBaseData.isMultiplePlayerMode?r=[e.TASK_VALUE_TYPE.TOTAL_SURPASS]:GameBaseData.isSinglePlayerMode&&(r=[e.TASK_VALUE_TYPE.TOTAL_DISTANCE]);for(var o=null,l=0;l<r.length&&!(o=e.SkinManager.getNextUnlockedSkinTask(r[l]));l++);if(null!=o){var h=e.TaskManager.instance.getTaskProgress(o.type);this.boxSkinTask.visible=!0,this.txtTaskDesc.text=e.TaskManager.getTaskDesc({type:o.type,value:o.value}),this.txtTaskProgress.text=e.TaskManager.getTaskProgress(o,h.value),this._nextSkinId=o.rewardValue}else this.boxSkinTask.visible=!1,this._nextSkinId=e.GameData.instance.skinIndex},a.prototype.showSkin=function(){this._scene=new Laya.Scene,this.addChild(this._scene);var t=new e.CustomMaterial;t.setTransparent(),t.setFogDensity(.04);var a=new Laya.SphereMesh(.15,64,64);this._ball=new Laya.MeshSprite3D(a),this._ball.transform.position=new Laya.Vector3(.03,.25,0),this._ball.meshRender.material=t;var n=this;this._ball.timer.loop(10,this._ball,function(){n._ball.transform.rotate(new Laya.Vector3(4,4,0),!0,!1)}),this._scene.addChild(this._ball),this._camera=new Laya.Camera,this._scene.addChild(this._camera),this._camera.viewport=new Laya.Viewport(this.x,this.y,this.width,this.height),this._camera.fieldOfView=65,this._camera.transform.position=new Laya.Vector3(0,0,3),this._light=new Laya.PointLight,this._light.transform.position=new Laya.Vector3(0,20,0),this._light.range=100,this._light.attenuation=new Laya.Vector3(0,0,0),this._scene.addChild(this._light),this.udpateSkin(this._nextSkinId),this.imgBall.visible=!1},a.prototype.udpateSkin=function(t){this._ball.meshRender.material.setDiffuseTexture(e.GameFactory.instance.getSkinTexture(t)),this._ball.meshRender.material.setColor(new Laya.Vector4(1,1,1,1)),this._ball.active=!0},a.prototype.onAwards=function(){SdkHelper.EventLogger.logDailyGiftPage(e.IndexView.PAGE),e.GameModule.instance.event(e.GameEvent.OPEN_GIFT)},a.PAGE="Result",a}(ui.GameResultViewUI);e.GameResultView=t}(touch||(touch={}));