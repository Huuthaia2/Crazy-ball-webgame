var touch,__extends=this&&this.__extends||function(){var e=function(a,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,a){e.__proto__=a}||function(e,a){for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])})(a,t)};return function(a,t){function n(){this.constructor=a}e(a,t),a.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(e){var a=function(a){function t(e){var n=a.call(this)||this;return n._main=null,n._datas=null,n._curShowIndex=0,n._isReqing1=!1,n._isReqing2=!1,n._modelType=0,t._openTimes++,n._main=e,n.btnClose.clickHandler=Laya.Handler.create(n,n.onClose,null,!1),n.listRank.vScrollBarSkin="",n.listRank.renderHandler=Laya.Handler.create(n,n.onRenderItem,null,!1),n.listRank.array=new Array(0),n._datas=new Array,n._modelType=2,n._isReqing1=n._isReqing2=!1,t._openTimes>5&&(t._openTimes=0,t._isReqAllData1=t._isReqAllData2=!1),n.initRankData(n._modelType),n}return __extends(t,a),t.prototype.initRankData=function(e){var a=this;if(GameBaseData.isFBSDK){e>=2&&GameBaseData.getNewModeMyRank(function(){GameBaseData.isDebug&&console.log("自己排行获取成功"),a.updateList(0)},function(){a.updateList(0)})}},t.prototype.destroy=function(){this._main=null,null!=this.btnClose.clickHandler&&(this.btnClose.clickHandler.recover(),this.btnClose.clickHandler=null),null!=this.listRank.renderHandler&&(this.listRank.renderHandler.recover(),this.listRank.renderHandler=null),this._datas.splice(0,this._datas.length),this._datas=null,a.prototype.destroy.call(this)},t.prototype.onClose=function(){e.Notice.closeLoading(),this._main.event(e.GameEvent.CLOSE_NewMode_RANK)},t.prototype.onGModel2=function(){this.onOpened()},t.prototype.onRenderItem=function(e,a){if(!(null==e||null==this._datas||a+3>=this._datas.length)){var t=this._datas[a+3];e.imgHead.skin=t.icon,e.tfName.text=t.name,e.tfRank.text=""+(t.rank+1),e.tfScore.text=t.score.toString(),e.clipBG.index=t.id==GameBaseData.UID?1:0}},t.prototype.onOpened=function(){a.prototype.onOpened.call(this),this._curShowIndex=0,this._datas.splice(0,this._datas.length),this.listRank.scrollTo(0),this.FbPageData(0,this._modelType)},t.prototype.reqPageData=function(a){if(!t._isReqAllData1&&!this._isReqing1&&(GameBaseData.isDebug&&console.log("获取排行reqPageData"),Laya.Browser.onMiniGame)){var n=this;this._isReqing1=!0,Laya.Browser.window.wx.showLoading({title:"数据加载中...",mask:!0}),Laya.Browser.window.wx.request({url:e.WechatSDK.SERVER+"get-rank?page="+a,method:"GET",header:{"content-type":"application/x-www-form-urlencoded"},fail:function(e){GameBaseData.isDebug&&console.log("获取世界排行页数据失败："+JSON.stringify(e))},success:function(a){if(200==a.statusCode){var i=a.data;if(i.err)GameBaseData.isDebug&&console.log("获取世界排行页数据失败：",i.err);else{GameBaseData.isDebug&&console.log("获取世界排行页数据成功："+i.data);var o=i.data.start,s=(i.data.stop,i.data.user_id),l=0;t._isReqAllData1=s.length<20,0==s.length&&(Laya.Browser.window.wx.hideLoading({}),n._isReqing1=!1);for(var r=function(){var a=new e.WorldRankItemData;a.rank=o+d,n._datas.push(a),Laya.Browser.window.wx.request({url:e.WechatSDK.SERVER+"get-data?id="+s[d],method:"GET",header:{"content-type":"application/x-www-form-urlencoded"},complete:function(e){++l>=s.length&&(Laya.Browser.window.wx.hideLoading({}),n._isReqing1=!1)},fail:function(e){GameBaseData.isDebug&&console.log("获取个人数据失败："+JSON.stringify(e))},success:function(e){if(200==e.statusCode){var t=e.data;t.err?GameBaseData.isDebug&&console.log("获取个人数据失败：",t.err):(GameBaseData.isDebug&&console.log("获取个人数据成功："+t.data),a.id=t.data.id,a.score=t.data.score,a.name=t.data.name,a.icon=t.data.icon,n.updateUI())}}})},d=0;d<s.length;d++)r()}}}})}},t.prototype.FbPageData=function(a,n){var i=this;if(e.Notice.showLoading(),n>=2){if(t._isReqAllData1||this._isReqing1)return GameBaseData.isDebug&&console.log("请求排行完毕    modelType=="+n),this.updateList(0),void this.updateList(1);GameBaseData.isDebug&&console.log("请求排行    modelType=="+n),this.initRankData(this._modelType),this._isReqing1=!0,GameBaseData.getNewModeRankList(function(){i._isReqing1=!1,GameBaseData.isDebug&&console.log("排行更新成功"),i.updateList(0),i.updateList(1),e.Notice.closeLoading()},function(){i._isReqing1=!1,GameBaseData.isDebug&&console.log("排行更新失败"),i.updateList(1),e.Notice.closeLoading()})}},t.prototype.updateList=function(a){if(this._modelType>=2)if(0==a)null!=GameBaseData.newModeMyRank?(this.viewMySelf.imgHead.skin=GameBaseData.newModeMyRank.pic,this.viewMySelf.tfName.text=GameBaseData.newModeMyRank.name,this.viewMySelf.tfRank.text=""+(GameBaseData.newModeMyRank.rank+1),this.viewMySelf.tfScore.text=""+GameBaseData.newModeMyRank.score,this.viewMySelf.clipBG.index=1):(this.viewMySelf.imgHead.skin=null,this.viewMySelf.tfName.text="",this.viewMySelf.tfRank.text="",this.viewMySelf.tfScore.text="",this.viewMySelf.clipBG.index=1);else{if(GameBaseData.newModeallRank&&GameBaseData.newModeallRank.length>0){t._isReqAllData1=!0,GameBaseData.isDebug&&console.log(GameBaseData.newModeallRank),this._datas=[];for(var n=0;n<GameBaseData.newModeallRank.length;n++){var i=new e.WorldRankItemData;i.rank=GameBaseData.newModeallRank[n].rank,i.id=GameBaseData.newModeallRank[n].uuid,i.score=GameBaseData.newModeallRank[n].score+"",i.name=GameBaseData.newModeallRank[n].name,i.icon=GameBaseData.newModeallRank[n].pic,this._datas.push(i)}}else this._datas=[];this.updateUI()}},t.prototype.updateUI=function(){var e=this._datas.length-3;e=e>0?e:0,this.listRank.array=new Array(e),this.listRank.scrollTo(this._curShowIndex);for(var a=0;a<3;a++)if(a<this._datas.length){var t=this._datas[a];if(null!=(n=this.getChildByName("boxRank"+a))){null!=(i=n.getChildByName("imgHead"))&&(i.skin=t.icon);null!=(o=n.getChildByName("tfName"))&&(o.text=t.name,o.text.length>10&&(o.fontSize=26-2*(o.text.length-10),o.fontSize<18&&(o.fontSize=18)));null!=(s=n.getChildByName("tfScore"))&&(s.text=t.score.toString())}}else{var n=this.getChildByName("boxRank"+a);if(null!=n){var i=n.getChildByName("imgHead");null!=i&&(i.skin=null);var o=n.getChildByName("tfName");null!=o&&(o.text="");var s=n.getChildByName("tfScore");null!=s&&(s.text="")}}},t._isReqAllData1=!1,t._isReqAllData2=!1,t._openTimes=0,t}(ui.NewModeRankDialogUI);e.NewModeRankDialog=a}(touch||(touch={}));