var touch,__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(e){var t=function(t){function n(n,i){var a=t.call(this)||this;return a._main=null,a._scene=null,a._camera=null,a._ball=null,a._ballSkinTexture=null,a._light=null,a._skinIndex=0,a._selectedSkinCell=null,a._currentSkinPageIndex=0,a._skinPageCategory=[],a._pageIndicatorSkins=[],a._main=n,a._ballSkinTexture=i,a.btnClose.clickHandler=Laya.Handler.create(a,a.onClickClose,null,!1),a.btnUse.clickHandler=Laya.Handler.create(a,a.onClickUse,null,!1),a.listSkin.visible=!1,a.imgRandom.visible=!1,a.boxPageIndicator.visible=!0,a._skinPageCategory=[e.TASK_VALUE_TYPE.TOTAL_DISTANCE,e.TASK_VALUE_TYPE.TOTAL_SURPASS,e.TASK_VALUE_TYPE.NONE],a.listSkinPages.array=a._skinPageCategory,a.listSkinPages.hScrollBarSkin="",a.listSkinPages.renderHandler=Laya.Handler.create(a,a.skinListRender,null,!1),a.listSkinPages.onPageChangeHandler=a.onPageChange.bind(a),a._pageIndicatorSkins.push(a.boxPageIndicator.getChildByName("imgSelected").skin),a._pageIndicatorSkins.push(a.boxPageIndicator.getChildByName("imgUnselected").skin),a._skinIndex=e.GameData.instance.skinIndex,a._updateSelectSkinInfo(),a.tfDiamond.text=e.GameData.instance.diamond.toString(),a.btnBuy.clickHandler=Laya.Handler.create(a,a.onClickBuy,null,!1),Laya.timer.callLater(a,a.showSkin),Laya.timer.callLater(a,function(){a.scrollToSkin(a._skinIndex)}),a}return __extends(n,t),n.prototype.scrollToSkin=function(t){var n=e.SkinManager.getSkinInfoById(t),i=this._skinPageCategory.indexOf(n.taskType);this.listSkinPages.scrollTo(i),this.onPageChange(i)},n.prototype._updateSelectSkinInfo=function(t){t||(t=e.SkinManager.getSkinInfoById(this._skinIndex));var n=e.TaskManager.instance.getTaskProgress(t.taskType);n&&(this.ballDes.text=e.TaskManager.getTaskDesc({type:t.taskType,value:t.taskValue}),this.ballPro.text=e.TaskManager.getTaskProgress({type:t.taskType,value:t.taskValue},n.value));var i=t.unlocked,a=e.GameData.instance.skinIndex==this._skinIndex;this.btnUse.visible=i&&!a,this.btnBuy.visible=!i,i||(this.tfCostDiamond.text=t.price.toString()),this.ballDes.visible=!i,this.imgDes.visible=!i,this.ballPro.visible=!i&&t.taskType!=e.TASK_VALUE_TYPE.NONE,this.boxSkinTask.visible=!i&&t.taskType!=e.TASK_VALUE_TYPE.NONE},n.prototype.destroy=function(){null!=this.btnClose.clickHandler&&(this.btnClose.clickHandler.recover(),this.btnClose.clickHandler=null),null!=this.btnBuy.clickHandler&&(this.btnBuy.clickHandler.recover(),this.btnBuy.clickHandler=null),null!=this.btnUse.clickHandler&&(this.btnUse.clickHandler.recover(),this.btnUse.clickHandler=null),t.prototype.destroy.call(this)},n.prototype.onClickClose=function(){this._main.event(e.GameEvent.CLOSE_SKIN),SdkHelper.SdkUtils.setAdflyState(1)},n.prototype.onClickUse=function(){e.GameData.instance.skinIndex=this._skinIndex,this._updateSelectSkinInfo(),this._refreshList(),this.updateSkin(),this._main.event(e.GameEvent.CHANGE_SKIN)},n.prototype._refreshList=function(){this.listSkinPages.array=this._skinPageCategory,this.listSkinPages.cells.forEach(function(e){e.getChildAt(0).refresh()})},n.prototype.onPageChange=function(e){this._currentSkinPageIndex=e,this._updatePageIndicator(e)},n.prototype._updatePageIndicator=function(e){for(var t=0;t<this.boxPageIndicator.numChildren;t++){var n=this.boxPageIndicator.getChildAt(t);n.skin=t==e?this._pageIndicatorSkins[0]:this._pageIndicatorSkins[1]}},n.prototype.skinListRender=function(t,n){var i=t.getChildByName("listItems");if(i){i.vScrollBarSkin="",i.selectEnable=!0,i.renderHandler=Laya.Handler.create(this,this.onSkinRender,null,!1),i.selectHandler=Laya.Handler.create(this,this.onSkinSelect,null,!1);var a=this.listSkinPages.array[n],s=e.SkinManager.getSkinsByUnlockCondition(a);i.array=s,i.refresh()}},n.prototype.onSkinRender=function(t,n){var i=t.parent.parent.array[n],a=i.skin;t.imgSkin.skin="index/skin"+a+".png",t.imgChoose.visible=e.GameData.instance.skinIndex==a;var s=i.unlocked;t.imgLock.visible=!s,t.imgSel.visible=a==this._skinIndex,t.imgBG.visible=!t.imgSel.visible,t.imgVideo.visible=e.GameConfig.SKIN_TYPE[a]>0,t.tfVideo.visible=!1,e.GameData.instance.skinIndex==a&&(this._selectedSkinCell=t)},n.prototype.onSkinSelect=function(t){console.log("Select Ball cellIndex: ",t);var n=this._skinPageCategory[this._currentSkinPageIndex],i=e.SkinManager.getSkinsByUnlockCondition(n);console.log("Select Ball currentPage: ",i),console.assert(i&&i.length>0);var a=i[t],s=a.skin;console.log("Select Ball: ",s),this.tfDiamond.text=e.GameData.instance.diamond.toString(),this._skinIndex=s,e.GameConfig.SKIN_TYPE[s]=0,this._updateSelectSkinInfo(a),this._refreshList(),this.updateSkin()},n.prototype.showSkin=function(){this._scene=new Laya.Scene,this.addChild(this._scene);var t=new e.CustomMaterial;t.setTransparent(),t.setFogDensity(.04);var n=new Laya.SphereMesh(.15,64,64);this._ball=new Laya.MeshSprite3D(n),this._ball.transform.position=new Laya.Vector3(.03,2.22,0),this._ball.meshRender.material=t;var i=this;this._ball.timer.loop(10,this._ball,function(){i.tfDiamond.text=e.GameData.instance.diamond.toString(),i._ball.transform.rotate(new Laya.Vector3(4,4,0),!0,!1)}),this._scene.addChild(this._ball),this._camera=new Laya.Camera,this._scene.addChild(this._camera),this._camera.viewport=new Laya.Viewport(this.x,this.y,this.width,this.height),this._camera.transform.translate(new Laya.Vector3(0,1.2,3),!1),this._light=new Laya.PointLight,this._light.transform.position=new Laya.Vector3(0,20,0),this._light.range=100,this._light.attenuation=new Laya.Vector3(0,0,0),this._scene.addChild(this._light),this.updateSkin()},n.prototype.updateSkin=function(){this._ball.meshRender.material.setDiffuseTexture(this._ballSkinTexture[this._skinIndex]),this._ball.meshRender.material.setColor(new Laya.Vector4(1,1,1,1)),this._ball.active=!0,this.imgRandom.visible=!1},n.prototype.hideSkin=function(){null!=this._ball&&(this._ball.destroy(),this._ball=null),null!=this._camera&&(this._camera.destroy(),this._camera=null),null!=this._scene&&(this._scene.destroy(),this._scene=null)},n.prototype.onClickBuy=function(){var t=e.SkinManager.getSkinInfoById(this._skinIndex).price;if(e.GameData.instance.diamond>=t){e.GameData.instance.setAddDiamond(-t),this.tfDiamond.text=e.GameData.instance.diamond.toString();var i=this._skinIndex;e.SkinManager.unlockSkin(i),e.SkinManager.save(),this._updateSelectSkinInfo(),this._main.event(e.GameEvent.SHOW_REWARD,[i]),this.onClickUse()}else SdkHelper.EventLogger.logDailyGiftPage(n.PAGE),e.Notice.show("Not Enough Diamond"),this._main.event(e.GameEvent.OPEN_GIFT)},n.PAGE="SkinShop",n}(ui.SkinDialogUI);e.SkinDialog=t}(touch||(touch={}));